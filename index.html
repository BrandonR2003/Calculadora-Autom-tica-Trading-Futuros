<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cal Futures</title>
  <link rel="icon" href="logo.ico">

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      background-color: #121212;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #container {
      display: flex;
      gap: 40px;
      transition: all 0.5s ease;
    }

    .card {
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
      width: 350px;
      transition: all 0.5s ease;
    }

    h2 {
      text-align: center;
      margin-bottom: 1px;
      color: #fff;
    }

    label {
      display: block;
      margin-top: 2px;
      font-size: 0.9rem;
    }

    input, select {
      width: 100%;
      padding: 4px;
      margin-top: 2px;
      background-color: #2c2c2c;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 0.8rem;
    }

    button {
      width: 100%;
      margin-top: 15px;
      padding: 8px;
      background-color: #0a84ff;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #006be6;
    }

    #resultCard, #tpCard {
      display: none;
    }

    .result {
      font-size: 1rem;
      margin-top: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.85rem;
    }

    th, td {
      border: 1px solid #333;
      padding: 6px;
      text-align: center;
    }

    th {
      background-color: #2c2c2c;
    }

    .be-row {
      background-color: #ffffff33;
      font-weight: bold;
    }

    .tp-final-row {
      background-color: #cecece59;
      font-weight: bold;
      color: #ffffff;
    }

    /* ------------------------------------------------------------------
       RESPONSIVE PARA CELULAR
    ------------------------------------------------------------------ */
    @media (max-width: 600px) {
      body {
        height: auto;
        padding: 20px 0;
        align-items: flex-start;
        display: flex;
        justify-content: center;
      }

      #container {
        flex-direction: column;
        gap: 20px;
        width: 100%;
        padding: 0 15px;
        justify-content: center;
      }

      .card {
        width: 100% !important;
        max-width: 350px;
        margin: auto;
        box-sizing: border-box;
        padding: 15px;
      }

      h2 {
        font-size: 1.3rem;
      }

      input, select {
        font-size: 0.95rem;
        padding: 8px;
      }

      button {
        padding: 12px;
        font-size: 1rem;
      }

      table {
        font-size: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <div id="container">

    <!-- TARJETA DE DATOS -->
    <div class="card" id="inputCard">
      <h2>DATOS</h2>

      <label for="symbol">Activo:</label>
      <select id="symbol">
        <option value="ES">ES (E-MINI S&P 500)</option>
        <option value="MES">MES (MICRO S&P 500)</option>
        <option value="NQ">NQ (E-MINI NASDAQ)</option>
        <option value="MNQ">MNQ (MICRO NASDAQ)</option>
        <option value="RTY">RTY (E-MINI RUSSELL)</option>
        <option value="M2K">M2K (MICRO RUSSELL)</option>
        <option value="HE">HE (LEAN HOG)</option>
        <option value="LE">LE (LIVE CATTLE)</option>
        <option value="6A">6A (AUSTRALIAN DOLLAR)</option>
        <option value="M6A">M6A (E-MICRO AUD/USD)</option>
        <option value="6B">6B (BRITISH POUND)</option>
        <option value="6C">6C (CANADIAN DOLLAR)</option>
        <option value="6E">6E (EURO)</option>
        <option value="M6E">M6E (E-MICRO EUR/USD)</option>
        <option value="6J">6J (JAPANESE YEN)</option>
        <option value="6N">6N (NEW ZEALAND)</option>
        <option value="6S">6S (SWISS FRANC)</option>
        <option value="YM">YM (E-MINI DOW JONES INDEX)</option>
        <option value="MYM">MYM (MICRO E-MINI DOW JONES INDEX)</option>
        <option value="ZC">ZC (CORN)</option>
        <option value="ZL">ZL (SOYBEAN OIL)</option>
        <option value="ZM">ZM (SOYBEAN MEAL)</option>
        <option value="ZS">ZS (SOYBEAN)</option>
        <option value="ZW">ZW (WHEAT)</option>
        <option value="GC">GC (COMEX 100 GOLD)</option>
        <option value="QO">QO (E-MINI GOLD)</option>
        <option value="MGC">MGC (10 TROY OZ GOLD)</option>
        <option value="HG">HG (COMEX COPPER)</option>
        <option value="MHG">MHG (MICRO COPPER)</option>
        <option value="SI">SI (COMEX 5000 SILVER)</option>
        <option value="CL">CL (CRUDE OIL)</option>
        <option value="QM">QM (E-MINI CRUDE OIL)</option>
        <option value="MCL">MCL (MICRO CRUDE OIL)</option>
        <option value="NG">NG (NATURAL GAS HENRY HUB)</option>
        <option value="QG">QG (E-MINI NATURAL GAS)</option>
        <option value="RB">RB (RBOB GASOLINE)</option>
        <option value="QI">QI (COMEX MINY SILVER)</option>
        <option value="GF">GF (FEEDER CATTLE)</option>
        <option value="MBT">MBT (MICRO BITCOIN)</option>
        <option value="MET">MET (MICRO ETHER)</option>
        <option value="EMD">EMD (E-MINI MIDCAP)</option>
        <option value="HO">HO (NY HARBOR ULSD)</option>
      </select>


      <label for="comision">Tipo de Cuenta:</label>
     <select id="comision" onchange="actualizarActivos()">
        <option value="FN">FN Futures</option>
        <option value="APEX">Apex</option>
      </select>


      <label for="capital">Capital ($):</label>
      <select id="capital">
        <option value="25000">$25,000</option>
        <option value="50000">$50,000</option>
        <option value="100000">$100,000</option>
        <option value="150000">$150,000</option>
        <option value="250000">$250,000</option>
        <option value="300000">$300,000</option>
      </select>

      <label for="entrada">Precio de Entrada:</label>
      <input type="number" id="entrada" step="0.01" />

      <label for="type">Tipo de Orden:</label>
      <select id="type">
        <option value="buy">Buy</option>
        <option value="sell">Sell</option>
      </select>

      <label for="tpTics">Tics TP:</label>
      <input type="number" inputmode="numeric" pattern="[0-9]" id="tpTics" step="1" />

      <label for="slTics">Tics SL:</label>
      <input type="number" inputmode="numeric" pattern="[0-9]" id="slTics" step="1" />

      <label for="riesgo">Riesgo (%):</label>
      <select id="riesgo">
        <option value="1">1%</option>
        <option value="0.80">0.80%</option>
        <option value="0.75">0.75%</option>
        <option value="0.60">0.60%</option>
        <option value="0.50">0.50%</option>
        <option value="0.45">0.45%</option>
        <option value="0.40">0.40%</option>
        <option value="0.33">0.33%</option>
        <option value="0.30">0.30%</option>
        <option value="0.25">0.25%</option>
        <option value="0.20">0.20%</option>
        <option value="0.15">0.15%</option>
        <option value="0.125">0.125%</option>
        <option value="0.10">0.10%</option>
        <option value="0.05">0.05%</option>
      </select>

      <button onclick="calcular()">Calcular</button>
    </div>

    <!-- RESULTADOS -->
    <div class="card" id="resultCard">
      <h2>RESULTADOS</h2>
      <br>
      <div class="result" id="lotajeResult"></div>
      <div class="result" id="rrResult"></div>
      <div class="result" id="ComisionResult"></div>
      <br>
      <div class="result" id="tpPriceResult"></div>
      <div class="result" id="profitResult"></div>
      <br>
      <div class="result" id="slPriceResult"></div>
      <div class="result" id="lossResult"></div>
    </div>

    <!-- TP PARCIALES -->
    <div class="card" id="tpCard">
      <h2>TP PARCIALES</h2>
      <br>
      <table>
        <thead>
          <tr>
            <th>R</th>
            <th>%</th>
            <th>Tics</th>
            <th>Precio</th>
            <th>Profit Neto</th>
          </tr>
        </thead>
        <tbody id="tpTable"></tbody>
      </table>
    </div>

  </div>

<script>

  const activosPorCuenta = {
  FN: ["ES", "MES", "NQ", "MNQ", "RTY", "M2K", "HE", "LE", "6A", "M6A", "6B", "6C", "6E", "6J", "6N", "6S", "YM", "MYM", "ZC", "ZL", "ZM", "ZS", "ZW", "GC", "MGC", "HG", "MHG", "SI", "CL", "QM", "MCL", "NG", "QG", "RB"],
  APEX: ["EMD", "ES", "MES", "NQ", "MNQ", "RTY", "M2K", "MBT", "MET", "GF", "HE", "LE", "6A", "M6A", "6B", "6C", "6E", "M6E", "6J", "6N", "6S", "YM", "MYM", "ZC", "ZL", "ZM", "ZS", "ZW", "GC", "QO", "MGC", "HG", "QI", "SI", "CL", "QM", "MCL", "HO", "NG", "QG", "RB"]
};

  function actualizarActivos() {
  const cuenta = document.getElementById("comision").value;
  const selectActivo = document.getElementById("symbol");
    
  const activosPermitidos = activosPorCuenta[cuenta];

  // guardamos el activo actual
  const activoActual = selectActivo.value;

  // limpiamos el select
  selectActivo.innerHTML = "";

  activosPermitidos.forEach(activo => {
    const option = document.createElement("option");
    option.value = activo;
    option.textContent = activo;
    selectActivo.appendChild(option);
  });

  // si el activo anterior sigue siendo v√°lido, lo conservamos
  if (activosPermitidos.includes(activoActual)) {
    selectActivo.value = activoActual;
  }
}

function calcular() {
  const capital = parseFloat(document.getElementById("capital").value);
  const riesgoPct = parseFloat(document.getElementById("riesgo").value);
  const entrada = parseFloat(document.getElementById("entrada").value);
  const slTics = parseFloat(document.getElementById("slTics").value);
  const tpTics = parseFloat(document.getElementById("tpTics").value);
  const tipo = document.getElementById("type").value;
  const activo = document.getElementById("symbol").value;
  const cuenta = document.getElementById("comision").value;

  if (!activosPorCuenta[cuenta].includes(activo)) {
  alert("Este activo no est√° disponible para la cuenta seleccionada");
  return;
}
  
  if (!slTics || !tpTics || slTics <= 0) {
    alert("TP y SL inv√°lidos");
    return;
  }

  const activos = {
    "EMD":{ tickSize: 0.10, tickValue: 0.00, comision: { APEX: 1.0, FN: 0.00 }, dec: 1 },
    "ES Hola": { tickSize: 0.25, tickValue: 12.5, comision: { APEX: 3.10, FN: 5.76 }, dec: 2 },
    "MES": { tickSize: 0.25, tickValue: 1.25, comision: { APEX: 1.04, FN: 1.90 }, dec: 2 },
    "NQ": { tickSize: 0.25, tickValue: 5, comision: { APEX: 3.10, FN: 5.76 }, dec: 2 },
    "MNQ": { tickSize: 0.25, tickValue: 0.5, comision: { APEX: 1.04, FN: 1.90 }, dec: 2 },
    "RTY":{ tickSize: 0.1, tickValue: 5, comision: { APEX: 3.10, FN: 5.76 }, dec: 1 },
    "M2K":{ tickSize: 0.1, tickValue: 0.5, comision: { APEX: 1.04, FN: 1.9 }, dec: 1 },
    "MBT":{ tickSize: 5, tickValue: 0.50, comision: { APEX: 5.34, FN: 0.00 }, dec: 0 },
    "MET":{ tickSize: 0.5, tickValue: 0.05, comision: { APEX: 0.74, FN: 0.00 }, dec: 1 },
    "GF":{ tickSize: 0.03, tickValue: 12.50, comision: { APEX: 4.54, FN: 6.20 }, dec: 3 },
    "HE":{ tickSize: 0.03, tickValue: 10.0, comision: { APEX: 4.54, FN: 7.2 }, dec: 3 },
    "LE":{ tickSize: 0.03, tickValue: 10.0, comision: { APEX: 4.54, FN: 7.2 }, dec: 3 },
    "6A":{ tickSize: 0.00005, tickValue: 5.0, comision: { APEX: 3.54, FN: 6.2 }, dec: 5 },
    "M6A":{ tickSize: 0.0001, tickValue: 10.0, comision: { APEX: 0.82, FN: 1.68 }, dec: 4 },
    "6B":{ tickSize: 0.0001, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 4 },
    "6C":{ tickSize: 0.00005, tickValue: 5.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "6E":{ tickSize: 0.00005, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "M6E":{ tickSize: 0.0001, tickValue: 1.25, comision: { APEX: 0.82, FN: 0.00 }, dec: 4 },
    "6J":{ tickSize: 0.0000005, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 7 },
    "6N":{ tickSize: 0.00005, tickValue: 5.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "6S":{ tickSize: 0.00005, tickValue: 6.25, comision: { APEX: 3.54, FN: 6.20 }, dec: 5 },
    "YM":{ tickSize: 1.00, tickValue: 5.00, comision: { APEX: 3.10, FN: 5.76 }, dec: 0 },
    "MYM":{ tickSize: 1.00, tickValue: 0.50, comision: { APEX: 1.04, FN: 1.90 }, dec: 0 },
    "ZC":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 4.54, FN: 1.00 }, dec: 2 },
    "ZL":{ tickSize: 0.01, tickValue: 6.00, comision: { APEX: 4.54, FN: 7.20 }, dec: 2 },
    "ZM":{ tickSize: 0.1, tickValue: 10.00, comision: { APEX: 4.54, FN: 7.20 }, dec: 1 },
    "ZS":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 4.54, FN: 0.00 }, dec: 2 },
    "ZW":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 4.54, FN: 0.00 }, dec: 2 },
    "GC":{ tickSize: 0.1, tickValue: 10.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 1 },
    "QO":{ tickSize: 0.25, tickValue: 12.50, comision: { APEX: 2.34, FN: 0.00 }, dec: 2 },
    "MGC":{ tickSize: 0.1, tickValue: 1.00, comision: { APEX: 1.34, FN: 2.40 }, dec: 1 },
    "HG":{ tickSize: 0.0005, tickValue: 12.50, comision: { APEX: 3.54, FN: 6.20 }, dec: 4 },
    "MHG":{ tickSize: 0.0005, tickValue: 1.25, comision: { APEX: 0.0, FN: 2.40 }, dec: 4 },
    "QI":{ tickSize: 0.0125, tickValue: 31.25, comision: { APEX: 2.34, FN: 0.00 }, dec: 4 },
    "SI":{ tickSize: 0.005, tickValue: 25.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 3 },
    "CL":{ tickSize: 0.01, tickValue: 10.00, comision: { APEX: 3.54, FN: 6.00 }, dec: 2 },
    "QM":{ tickSize: 0.025, tickValue: 12.50, comision: { APEX: 2.74, FN: 5.40 }, dec: 3 },
    "MCL":{ tickSize: 0.01, tickValue: 1.00, comision: { APEX: 1.34, FN: 2.20 }, dec: 2 },
    "HO":{ tickSize: 0.05, tickValue: 1.25, comision: { APEX: 0.0, FN: 0.00 }, dec: 4 },
    "NG":{ tickSize: 0.001, tickValue: 10.00, comision: { APEX: 3.54, FN: 6.20 }, dec: 3 },
    "QG":{ tickSize: 0.005, tickValue: 12.50, comision: { APEX: 1.34, FN: 4.00 }, dec: 3 },
    "RB":{ tickSize: 0.0001, tickValue: 4.20, comision: { APEX: 3.34, FN: 6.00 }, dec: 4 },
  };

  const { tickSize, tickValue, comision, dec } = activos[activo];
  const feePorContrato = comision[cuenta];

  const riesgoUSD = capital * (riesgoPct / 100);
  const riesgoPorContrato = (slTics * tickValue) + feePorContrato;

  let contratos = Math.floor(riesgoUSD / riesgoPorContrato);
  while ((contratos * riesgoPorContrato) > riesgoUSD) {
    contratos--;
  }

  if (contratos < 1) {
    alert("Riesgo insuficiente para 1 contrato");
    return;
  }

  // --- M√âTRICAS ---
  const rr = tpTics / slTics;
  const comisionTotal = contratos * feePorContrato;

  const tpPrice = tipo === "buy"
    ? entrada + tpTics * tickSize
    : entrada - tpTics * tickSize;

  const slPrice = tipo === "buy"
    ? entrada - slTics * tickSize
    : entrada + slTics * tickSize;

  const profitBruto = tpTics * tickValue * contratos;
  const profitNeto = profitBruto - comisionTotal;
  const lossNeto = contratos * riesgoPorContrato;

  // ================================
// TP PARCIALES POR % REAL (NETO)
// ================================
const tbody = document.getElementById("tpTable");
tbody.innerHTML = "";

// Paso en USD seg√∫n % seleccionado
const pasoUSD = capital * (riesgoPct / 100);

// Profit neto final seg√∫n TP en tics
const profitFinalNeto =
  (tpTics * tickValue * contratos) - comisionTotal;

// Nivel m√°ximo (redondeado hacia arriba)
const nivelMax = Math.ceil(profitFinalNeto / pasoUSD);

// --- BE REAL √ìPTIMO ---
const ticsExactosBE =
  comisionTotal / (tickValue * contratos);

const ticsBaseBE = Math.floor(ticsExactosBE);

let ticsBE = ticsBaseBE;

const profitBaseBE =
  (ticsBaseBE * tickValue * contratos) - comisionTotal;

// si queda negativo, subimos 1 tick
if (profitBaseBE < 0) {
  ticsBE = ticsBaseBE + 1;
}

// seguridad extra
ticsBE = Math.max(ticsBE, 0);

const profitBE =
  (ticsBE * tickValue * contratos) - comisionTotal;

const precioBE = tipo === "buy"
  ? entrada + ticsBE * tickSize
  : entrada - ticsBE * tickSize;

tbody.insertAdjacentHTML("beforeend", `
  <tr class="be-row">
    <td>BE</td>
    <td>${((profitBE / capital) * 100).toFixed(2)}%</td>
    <td>${ticsBE}</td>
    <td>${precioBE.toFixed(dec)}</td>
    <td>$${profitBE.toFixed(2)}</td>
  </tr>
`);

  // profit neto m√°ximo permitido por el TP real
const profitMaxPermitido =
  (tpTics * tickValue * contratos) - comisionTotal;

  let ticsNivelAnterior = ticsBE;

  let ultimaFila = null;

for (let nivel = 1; ; nivel++) {

  const objetivoUSD = pasoUSD * nivel;

  const ticsExactos =
    (objetivoUSD + comisionTotal) / (tickValue * contratos);

  let ticsObjetivo = Math.floor(ticsExactos);

  const profitBase =
    (ticsObjetivo * tickValue * contratos) - comisionTotal;

  if (profitBase < objetivoUSD) {
    ticsObjetivo++;
  }

  // üîë REGLA REAL:
  // si ya pas√© el nivel anterior aunque sea por 1 tick
  if (tpTics < ticsNivelAnterior + 1) break;

  const precioTP = tipo === "buy"
    ? entrada + ticsObjetivo * tickSize
    : entrada - ticsObjetivo * tickSize;

  const profitNetoNivel =
    (ticsObjetivo * tickValue * contratos) - comisionTotal;

  const claseFinal =
    ticsObjetivo <= tpTics ? "tp-final-row" : "";

  const filaHTML = `
  <tr>
    <td>${nivel}</td>
    <td>${(nivel * riesgoPct).toFixed(2)}%</td>
    <td>${ticsObjetivo}</td>
    <td>${precioTP.toFixed(dec)}</td>
    <td>$${profitNetoNivel.toFixed(2)}</td>
  </tr>
`;

tbody.insertAdjacentHTML("beforeend", filaHTML);
  
// guardamos referencia a la √∫ltima fila insertada
ultimaFila = tbody.lastElementChild;


  // üîë avanzamos al siguiente umbral REAL
  ticsNivelAnterior = ticsObjetivo;
}

if (ultimaFila) {
  ultimaFila.classList.add("tp-final-row");
}
  
  // --- OUTPUT ---
  document.getElementById("lotajeResult").textContent = `Contratos: ${contratos}`;
  document.getElementById("rrResult").textContent = `R:R 1:${rr.toFixed(2)}`;
  document.getElementById("ComisionResult").textContent = `Comisi√≥n: $${comisionTotal.toFixed(2)}`;

  document.getElementById("tpPriceResult").textContent = `Precio TP: ${tpPrice.toFixed(dec)}`;
  document.getElementById("slPriceResult").textContent = `Precio SL: ${slPrice.toFixed(dec)}`;

  document.getElementById("profitResult").textContent = `Profit Neto: $${profitNeto.toFixed(2)}`;
  document.getElementById("lossResult").textContent = `P√©rdida Neta: -$${lossNeto.toFixed(2)}`;

  document.getElementById("resultCard").style.display = "block";
  document.getElementById("tpCard").style.display = "block";
}

  window.onload = actualizarActivos;
</script>

</body>
</html>
